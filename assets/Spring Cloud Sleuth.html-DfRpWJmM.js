import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,o as a,a as n}from"./app-BXIyiqdS.js";const e={},l=n(`<h1 id="spring-cloud-sleuth-链路追踪" tabindex="-1"><a class="header-anchor" href="#spring-cloud-sleuth-链路追踪"><span>Spring Cloud Sleuth (链路追踪)</span></a></h1><p>基本术语</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>Spring Cloud Sleuth采⽤的是Google的开源项⽬Dapper的专业术语.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Span</span></span>
<span class="line"><span>    基本⼯作单元,发送⼀个远程调度任务 就会产⽣⼀个Span,Span有⼀个64位ID唯⼀标识的,Trace是⽤另⼀个64位ID唯⼀标识的,Span还有其他数据信息,⽐如摘要、时间戳事件、Span的ID、以及进度ID。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Trace</span></span>
<span class="line"><span>    ⼀系列Span组成的⼀个树状结构。请求⼀个微服务系统的API接⼝,这个API接⼝,需要调⽤多个微服务,调⽤每个微服务都会产⽣⼀个新的Span,所有由这个请求产⽣的Span组成了这个Trace。</span></span>
<span class="line"><span>Annotation</span></span>
<span class="line"><span>    ⽤来及时记录⼀个事件的,⼀些核⼼注解⽤来定义⼀个请求的开始和结束 。这些注解包括以下： cs - Client Sent -客户端发送⼀个请求,这个注解描述了这个Span的开始</span></span>
<span class="line"><span>    sr - Server Received -服务端获得请求并准备开始处理它,如果将其sr减去cs时间戳便可得到⽹络传输的时间。</span></span>
<span class="line"><span>    ss - Server Sent (服务端发送响应)–该注解表明请求处理的完成(当请求返回客户端),如果ss的时间戳减去sr时间戳,就可以得到服务器请求的时间。</span></span>
<span class="line"><span>    r - Client Received (客户端接收响应)-此时Span的结束,如果cr的时间戳减去cs时间戳便可以得到整个请求所消耗的时间</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://i.jpg.dog/f50a2a29c7744cffa8e6e1d2d751be50.png" alt="链路追踪术语" tabindex="0" loading="lazy"><figcaption>链路追踪术语</figcaption></figure><h2 id="案例" tabindex="-1"><a class="header-anchor" href="#案例"><span>案例</span></a></h2><h3 id="zipkin-server" tabindex="-1"><a class="header-anchor" href="#zipkin-server"><span>Zipkin-Server</span></a></h3><p>下载 Zipkin-Server 地址: https://archiva-maven-storage-prod.oss-cn-beijing.aliyuncs.com/repository/central/io/zipkin/zipkin-server/2.23.2/zipkin-server-2.23.2-exec.jar</p><p>启动Zipkin-Server java -jar zipkin-server-2.23.2-exec.jar</p><h4 id="zipkin-client" tabindex="-1"><a class="header-anchor" href="#zipkin-client"><span>Zipkin-Client</span></a></h4><p>添加依赖</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;org.springframework.cloud&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;spring-cloud-sleuth-zipkin&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;org.springframework.cloud&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-sleuth&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml中添加以下内容</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    application</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">        name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cloud-payment-service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    zipkin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">        base-url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">http://192.168.220.12:9411</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">        sender</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">            type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">web</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    sleuth</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">        sampler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">            probability</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># spring.zipkin.base-url：指定Zipkin的服务端,⽤于发送链路报告</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># spirng.zipkin.sender.type：web表示使⽤http发送数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># spring.sleuth.sampler.probability：采样率,值为[0,1]之间,这⾥表示100%采样报告</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用rabbitmq传输链路数据" tabindex="-1"><a class="header-anchor" href="#使用rabbitmq传输链路数据"><span>使⽤RabbitMQ传输链路数据</span></a></h4><p>在 docker 中安装 RabbitMQ</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rabbitmq:management</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 5672:5672</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 15672:15672</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rabbitmq</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rabbitmq:management</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Zipkin-Server 启动Zipkin-Server时,指定从RabbitMQ获得链路消息数据。命令如下</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>RABBIT_ADDRESSES=localhost java -jar zipkin-server-2.23.2-exec.jar</span></span>
<span class="line"><span>#或者下⾯命令</span></span>
<span class="line"><span>java -jar zipkin-server-2.23.2-exec.jar --zipkin.collector.rabbitmq.addresses=localhost</span></span>
<span class="line"><span># 注意这⾥使⽤localhost,故此需要把 zipkin-server-2.23.2-exec.jar 上传到docker所在的虚拟机。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Zipkin-Client中添加依赖</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;org.springframework.amqp&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;spring-rabbit&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改application.yml 配置,将链路数据发送给RabbitMQ</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    zipkin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">        rabbitmq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">            addresses</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.220.12:5672</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            # base-url: http://192.168.220.12:9411</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    sender</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">        type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">rabbit</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    sleuth</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">        sampler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">            probability</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 因为发送链路数据的⽅式type=rabbit,故此需要配置spring.zipkin.rabbitmq,同时base-url就不需要了</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用elasticsearch存储链路数据" tabindex="-1"><a class="header-anchor" href="#使用elasticsearch存储链路数据"><span>使⽤ElasticSearch存储链路数据</span></a></h4><p>Zipkin Server将链路数据存储在内存中,⼀旦程序重启,之前的链路数据全部丢失。</p><p>那么怎么将链路数据存储起来呢？</p><pre><code>Zipkin⽀持将链路数据存储在MySql、Elasticsearch,和Cassandra数据库中.
</code></pre><p>安装Elasticsearch和Kibana 使⽤docker安装Elasticsearch和Kibana。命令如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> elasticsearch:7.13.4</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 创建⾃定义的⽹络(⽤于连接到连接到同⼀⽹络的其他服务(例如Kibana))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> network</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> somenetwork</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#运⾏Elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> elasticsearch</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --net</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> somenetwork</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 9200:9200</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">9300:9300</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;discovery.type=single-node&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> elasticsearch:7.13.4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kibana:7.3.4</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 运⾏ Kibana</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kibana</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --net</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> somenetwork</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 5601:5601</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kibana:7.13.4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Zipkin-Server 启动Zipkin Server时,指定使⽤ES存储数据,命令如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">RABBIT_ADDRESSES</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">localhost</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> STORAGE_TYPE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">elasticsearch</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ES_HOSTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">http://localhost:9200</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> java</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -jar</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> zipkin-server-2.23.2-exec.jar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#或者 </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -jar</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> zipkin-server-2.23.2-exec.jar</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> zipkin.collector.rabbitmq.addresses=localhost</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --STORAGE_TYPE=elasticsearch</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --ES_HOSTS=http://localhost:9200</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,30),t=[l];function p(h,r){return a(),s("div",null,t)}const c=i(e,[["render",p],["__file","Spring Cloud Sleuth.html.vue"]]),g=JSON.parse('{"path":"/dev/java/springCloud/Spring%20Cloud%20Sleuth.html","title":"Spring Cloud Sleuth (链路追踪)","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2024-07-22T00:00:00.000Z","category":["后端开发","spring系列"],"tag":["java"],"description":"Spring Cloud Sleuth (链路追踪) 基本术语 链路追踪术语链路追踪术语 案例 Zipkin-Server 下载 Zipkin-Server 地址: https://archiva-maven-storage-prod.oss-cn-beijing.aliyuncs.com/repository/central/io/zipkin/zi...","head":[["meta",{"property":"og:url","content":"https://jia-shuaijie.github.io/dev/java/springCloud/Spring%20Cloud%20Sleuth.html"}],["meta",{"property":"og:site_name","content":"黑色的小火苗"}],["meta",{"property":"og:title","content":"Spring Cloud Sleuth (链路追踪)"}],["meta",{"property":"og:description","content":"Spring Cloud Sleuth (链路追踪) 基本术语 链路追踪术语链路追踪术语 案例 Zipkin-Server 下载 Zipkin-Server 地址: https://archiva-maven-storage-prod.oss-cn-beijing.aliyuncs.com/repository/central/io/zipkin/zi..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://i.jpg.dog/f50a2a29c7744cffa8e6e1d2d751be50.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-07-22T13:09:27.000Z"}],["meta",{"property":"article:author","content":"黑色的小火苗"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:published_time","content":"2024-07-22T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-07-22T13:09:27.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Spring Cloud Sleuth (链路追踪)\\",\\"image\\":[\\"https://i.jpg.dog/f50a2a29c7744cffa8e6e1d2d751be50.png\\"],\\"datePublished\\":\\"2024-07-22T00:00:00.000Z\\",\\"dateModified\\":\\"2024-07-22T13:09:27.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"黑色的小火苗\\",\\"url\\":\\"https://jia-shuaijie.github.io\\"}]}"]]},"headers":[{"level":2,"title":"案例","slug":"案例","link":"#案例","children":[{"level":3,"title":"Zipkin-Server","slug":"zipkin-server","link":"#zipkin-server","children":[{"level":4,"title":"Zipkin-Client","slug":"zipkin-client","link":"#zipkin-client","children":[]},{"level":4,"title":"使⽤RabbitMQ传输链路数据","slug":"使用rabbitmq传输链路数据","link":"#使用rabbitmq传输链路数据","children":[]},{"level":4,"title":"使⽤ElasticSearch存储链路数据","slug":"使用elasticsearch存储链路数据","link":"#使用elasticsearch存储链路数据","children":[]}]}]}],"git":{"createdTime":1721653767000,"updatedTime":1721653767000,"contributors":[{"name":"黑色的小火苗","email":"jiashuaijie@yeah.net","commits":1}]},"readingTime":{"minutes":3,"words":899},"filePathRelative":"dev/java/springCloud/Spring Cloud Sleuth.md","localizedDate":"2024年7月22日","excerpt":"\\n<p>基本术语</p>\\n<div class=\\"language- line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"\\" data-title=\\"\\" style=\\"--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes github-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>Spring Cloud Sleuth采⽤的是Google的开源项⽬Dapper的专业术语.</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>Span</span></span>\\n<span class=\\"line\\"><span>    基本⼯作单元,发送⼀个远程调度任务 就会产⽣⼀个Span,Span有⼀个64位ID唯⼀标识的,Trace是⽤另⼀个64位ID唯⼀标识的,Span还有其他数据信息,⽐如摘要、时间戳事件、Span的ID、以及进度ID。</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>Trace</span></span>\\n<span class=\\"line\\"><span>    ⼀系列Span组成的⼀个树状结构。请求⼀个微服务系统的API接⼝,这个API接⼝,需要调⽤多个微服务,调⽤每个微服务都会产⽣⼀个新的Span,所有由这个请求产⽣的Span组成了这个Trace。</span></span>\\n<span class=\\"line\\"><span>Annotation</span></span>\\n<span class=\\"line\\"><span>    ⽤来及时记录⼀个事件的,⼀些核⼼注解⽤来定义⼀个请求的开始和结束 。这些注解包括以下： cs - Client Sent -客户端发送⼀个请求,这个注解描述了这个Span的开始</span></span>\\n<span class=\\"line\\"><span>    sr - Server Received -服务端获得请求并准备开始处理它,如果将其sr减去cs时间戳便可得到⽹络传输的时间。</span></span>\\n<span class=\\"line\\"><span>    ss - Server Sent (服务端发送响应)–该注解表明请求处理的完成(当请求返回客户端),如果ss的时间戳减去sr时间戳,就可以得到服务器请求的时间。</span></span>\\n<span class=\\"line\\"><span>    r - Client Received (客户端接收响应)-此时Span的结束,如果cr的时间戳减去cs时间戳便可以得到整个请求所消耗的时间</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{c as comp,g as data};
